<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Collection Olivier</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <div class="brand">
        <img id="ownerPhoto" src="me.jpg" alt="Olivier" onerror="this.style.display='none'" />
        <h1>Collection Olivier</h1>
      </div>
      <div class="controls">
        <input id="search" type="search" placeholder="Recherche titre, artiste, label…" />
        <select id="genre"><option value="">Tous genres</option></select>
        <select id="style"><option value="">Tous styles</option></select>
        <select id="format"><option value="">Tous formats</option></select>
        <select id="year"><option value="">Toutes années</option></select>
        <select id="sort">
          <option value="">Tri</option>
          <option value="released">Date de sortie</option>
          <option value="country">Pays</option>
          <option value="title">Titre</option>
          <option value="artist">Artiste</option>
          <option value="price">Prix (moyenne)</option>
        </select>
        <select id="order">
          <option value="asc">Ascendant</option>
          <option value="desc">Descendant</option>
        </select>
        <select id="sort2">
          <option value="">Tri secondaire</option>
          <option value="title">Titre</option>
          <option value="artist">Artiste</option>
        </select>
        <select id="group">
          <option value="">Grouper</option>
          <option value="year">Année</option>
          <option value="label">Label</option>
          <option value="artist">Artiste</option>
        </select>
        <input id="minPrice" type="number" placeholder="Prix min (EUR)" step="0.01" />
        <input id="maxPrice" type="number" placeholder="Prix max (EUR)" step="0.01" />
        <button id="copy" type="button">Copier l’URL</button>
        <button id="reset" type="button">Réinitialiser</button>
        <button id="statsToggle" type="button">Stats</button>
        <button id="recentToggle" type="button">Derniers ajouts</button>
      </div>
    </header>
    <main>
      <div id="diagnostic" style="background: #330000; color: white; padding: 10px; margin-bottom: 10px; border: 1px solid red;">
        État du diagnostic : Initialisation...
      </div>
      <div id="loading" style="text-align:center; padding:20px; font-size:1.2em;">Chargement de la collection...</div>
      <div id="info" class="info"></div>
      <div id="stats" class="stats" hidden></div>
      <div id="recent" class="recent" hidden></div>
      <div id="grid" class="grid"></div>
    </main>
    <script>
      (function() {
        const diag = document.getElementById('diagnostic');
        function log(msg) {
          diag.innerHTML += '<br>' + msg;
          console.log('[Diag] ' + msg);
        }
        
        window.onerror = function(msg, url, line) {
          log('ERREUR GLOBALE: ' + msg + ' (' + url + ':' + line + ')');
          return false;
        };

        log('Page chargée. Vérification de app.js...');
        
        // Vérifier si app.js est chargé après 2 secondes
        setTimeout(() => {
          if (typeof loadData === 'undefined') {
            log('ERREUR: app.js ne semble pas avoir été chargé !');
          } else {
            log('OK: app.js est présent.');
          }
        }, 2000);
        
        // Test fetch direct
        fetch('collection.json').then(r => {
            log('Test fetch collection.json: ' + r.status + ' ' + r.statusText);
            if (!r.ok) {
                 fetch('data/collection.json').then(r2 => {
                     log('Test fetch data/collection.json: ' + r2.status + ' ' + r2.statusText);
                 }).catch(e => log('Exception fetch data/: ' + e));
            }
        }).catch(e => log('Exception fetch root: ' + e));
        
      })();
    </script>
    <script src="app.js"></script>
  </body>
</html>
